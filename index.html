<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Marda Loop Bakery</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .item-card { transition: transform 0.2s; }
        .item-card:active { transform: scale(0.95); }
    </style>
</head>
<body class="bg-gray-50 text-gray-900 pb-24">
    <!-- Header -->
    <header class="bg-white p-6 shadow-sm sticky top-0 z-10">
        <h1 class="text-2xl font-bold text-center text-orange-600">ü•ê Marda Loop Bakery</h1>
        <p id="weather-tip" class="text-sm text-gray-500 text-center mt-1 italic">Loading local vibes...</p>
    </header>

    <!-- Menu Items -->
    <main class="p-4 space-y-4">
        <div id="recommendation-badge" class="bg-orange-100 text-orange-800 text-xs font-semibold px-2.5 py-0.5 rounded hidden text-center">BEST FOR CURRENT WEATHER</div>
        
        <div class="grid grid-cols-1 gap-4" id="menu-container">
            <!-- Items will be injected by JS -->
        </div>
    </main>

    <script>
        let tg = window.Telegram.WebApp;
        tg.expand();
        tg.MainButton.setText("VIEW CART");
        tg.MainButton.hide();

        let order = {};
        const items = [
            { id: 1, name: "Fresh Baguette", price: 4.50, desc: "Crispy crust, soft inside (Best with soup!)", type: "warm" },
            { id: 2, name: "Iced Latte", price: 5.25, desc: "Perfect for a sunny Calgary afternoon", type: "cold" },
            { id: 3, name: "Maple Syrup Croissant", price: 3.75, desc: "A Canadian classic treat", type: "neutral" },
            { id: 4, name: "Hot Hot Cocoa", price: 4.00, desc: "Thick, rich and steaming hot", type: "warm" }
        ];

        function renderMenu(temp = 12) {
            const container = document.getElementById('menu-container');
            const weatherTip = document.getElementById('weather-tip');
            container.innerHTML = '';

            if (temp > 10) {
                weatherTip.innerText = "It's a beautiful " + temp + "¬∞C! Try our cold drinks.";
            } else {
                weatherTip.innerText = "Stay warm! It's " + temp + "¬∞C outside.";
            }

            items.forEach(item => {
                const isHighlight = (temp > 10 && item.type === 'cold') || (temp <= 10 && item.type === 'warm');
                container.innerHTML += `
                    <div class="item-card bg-white p-4 rounded-2xl shadow-sm border ${isHighlight ? 'border-orange-400' : 'border-gray-100'} flex justify-between items-center">
                        <div class="flex-1">
                            <h3 class="font-bold text-lg">${item.name}</h3>
                            <p class="text-sm text-gray-500">${item.desc}</p>
                            <span class="text-orange-600 font-semibold">$${item.price.toFixed(2)}</span>
                        </div>
                        <button onclick="addToCart(${item.id})" class="bg-orange-500 text-white rounded-xl p-3 h-12 w-12 hover:bg-orange-600">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                `;
            });
        }

        function addToCart(id) {
            const item = items.find(i => i.id === id);
            order[id] = (order[id] || 0) + 1;
            
            const total = Object.values(order).reduce((acc, qty) => acc + qty, 0);
            const totalPrice = Object.keys(order).reduce((acc, key) => acc + (items.find(i => i.id == key).price * order[key]), 0);
            
            tg.MainButton.setText(`CHECKOUT ${total} ITEMS ‚Ä¢ $${totalPrice.toFixed(2)}`);
            tg.MainButton.show();
        }

        tg.onEvent('mainButtonClicked', function() {
            tg.sendData(JSON.stringify(order));
            tg.close();
        });

        // Demo injection of "detected" temp
        renderMenu(12);
    </script>
</body>
</html>
